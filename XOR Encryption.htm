<html>
<head>
<script type="text/javascript">
function toAscii(text)
{
	var i;
	var num = new Array();
	for (i = 0; i < text.length; i++)
		num[i] = text.charCodeAt(i);
	return toBinary(num);
}

function toString(asciiNums)
{
	var i;
	var text = "";
	for (i = 0; i < asciiNums.length; i++)
		text[i] = asciiNums.fromCharCode(i);
	return text;
}

function toBinary(num)
{
	var text = new Array(), i, j;

	for (j = 0; j < num.length; j++)
	{
		var digits = Math.floor(Math.log(num[j])/Math.log(2)) + 1;

		if (digits < 8)
			digits = 8;

		for (i = digits-1; i >= 0; i--)
		{
			var div = Math.pow(2, i);
			if (num[j] >= div)
			{
				text[j*8 + (digits-1)-i] = 1;
				num[j] -= div;
			}
			else
				text[j*8 + (digits-1)-i] = 0;
		}
	}

	return text;
}

function dispBin(num)
{
	var text = "", i;
	for (i = 0; i < num.length; i++)
	{
		text += num[i];
		if ((i+1) % 8 == 0 && i+1 != num.length)
			text += " | ";
		
	}

	return(text);
}

function getBin(num)
{
	var arr = new Array(), i;
	for (i = 0; i < num.length; i++)
	{
		if (num[i] == "0" || num[i] == "1")
			arr[arr.length] = num[i];
	}

	return(arr);
}


//function dispStr(txt)
//{
//	var text = "", i;
//	for (i = 0; i < num.length; i++)
//		text += num[i];
//
//	return(text);
//}

function encode()
{
	var ans = new Array();
	var pswd = new Array();
	var text = "<table>";

	var i;

	ans = toAscii(document.getElementById('list').value);
	text += "<tr><td>" + dispBin(ans) + "</td></tr>";

	for (i = 0; i < ans.length; i+=8)
	{
		var temp = toAscii(document.getElementById('password').value);
		pswd[pswd.length] = temp[0];
		pswd[pswd.length] = temp[1];
		pswd[pswd.length] = temp[2];
		pswd[pswd.length] = temp[3];
		pswd[pswd.length] = temp[4];
		pswd[pswd.length] = temp[5];
		pswd[pswd.length] = temp[6];
		pswd[pswd.length] = temp[7];
	}
	text += "<tr><td>" + dispBin(pswd) + "</td></tr>";

//	for (i = 0; i < 2*ans.length; i++)
//		text += "-";
//	text += "<br>";

	text += "<tr><td style='border-top:solid 1px black'>"
	for (i = 0; i < ans.length; i++)
	{
		text += (ans[i] + pswd[i]) % 2;
		if ((i+1) % 8 == 0 && i+1 != ans.length)
			text += " | ";
	}
	text += "</td></tr>";
//	text = dispBin(text);
	document.getElementById("dcr").hidden = false;
	
	return text;
}

function decode()
{
	var ans;
	var pswd = new Array();
	var text = "<table>";

	var i;

	ans = document.getElementById('output').innerHTML;
//	alert("ans = " + ans);
	var loc1 = ans.lastIndexOf("<tr>");
//	alert("loc1 = " + loc1);
	ans = ans.substring(loc1+4, ans.length);
//	alert("ans = " + ans);
	loc1 = ans.indexOf(">");
//	alert("loc1 = " + loc1);
	ans = ans.substring(loc1+1, ans.indexOf("</td>"));
//	alert("ans = " + ans);

//	document.getElementById("output").innerHTML += ans + "<br>";
	text += "<tr><td>" + ans + "</td></tr>";
	ans = getBin(ans);
//	alert("ans = " + ans);
	
	for (i = 0; i < ans.length; i+=8)
	{
		var temp = toAscii(document.getElementById('password').value);
		pswd[pswd.length] = temp[0];
		pswd[pswd.length] = temp[1];
		pswd[pswd.length] = temp[2];
		pswd[pswd.length] = temp[3];
		pswd[pswd.length] = temp[4];
		pswd[pswd.length] = temp[5];
		pswd[pswd.length] = temp[6];
		pswd[pswd.length] = temp[7];
	}
	text += "<tr><td>" + dispBin(pswd) + "</td></tr>";
//	alert("pswd = " + pswd);
	
//	for (i = 0; i < 2*ans.length; i++)
//		text += "-";
//	text += "<br>";

	text += "<tr><td style='border-top:solid 1px black'>"
	for (i = 0; i < ans.length; i++)
	{
//		alert(ans[i] + " + " + pswd[i] + " = " + ((parseInt(ans[i]) + parseInt(pswd[i]))));
		text += (parseInt(ans[i]) + parseInt(pswd[i])) % 2;
		if ((i+1) % 8 == 0 && i+1 != ans.length)
			text += " | ";
	}
	text += "</td></tr>";
//	text = dispBin(text);
	
	return text;
}

</script>
</head>
<body>
<p>
</p>
<form name=data id=data>
 <input type=button onclick="javascript:location.reload(true)" value="New Problem"><br>
 <TEXTAREA style="WIDTH: 350px; HEIGHT: 150px" id=list cols=41 rows=6 name=list>This is a test</TEXTAREA><br>
 <input size=8 name="password" id="password" value="a">
<!-- <input type="button" value="Encrypt" onclick="ans = document.getElementById('output').innerHTML = dispBin(toBinary(document.getElementById('list').value)) + '<br>';">  -->
 <input type="button" value="Encrypt" onclick="document.getElementById('output').innerHTML = encode() + '<br>';">
 <input type="button" value="Decrypt" id="dcr" name="dcr" hidden onclick="document.getElementById('output').innerHTML += decode() + '<br>';">
<!--  <input type="button" value="Decrypt" onclick="document.getElementById('output').innerHTML = dispBin(toBinary(document.getElementById('list').value)) + '<br>';">-->
</FORM> 
<script type="text/javascript">
</script>
<p name="output" id="output">
</p>
</body>
</html>