<!DOCTYPE html>
<html>
<head>
<title>Puzzles</title>
<script type="text/javascript">
function updatePoss(poss, row, clm, val) 
{
	poss[row][clm] = [val];
	for (var i = 0; i < 4; i++) 
	{
//		document.getElementById("output").innerHTML += "(" + i + ", " + clm + ")" + typeof(poss[i][clm]) + " - " + poss[i][clm] + "<br>";
		if (i == row)
		{
			continue;
		}
//		document.getElementById("output").innerHTML += typeof(poss[i][clm]) + "<br>";
		var loc = poss[i][clm].indexOf(val);
		if (loc != -1)
		{
			poss[i][clm].splice(loc, 1);
		}
	}
	
	for (var i = 0; i < 4; i++)
	{
//		document.getElementById("output").innerHTML += "(" + row + ", " + i + ")" + typeof(poss[row][i]) + " - " + poss[row][i] + "<br>";
		if (i == clm)
		{
			continue;
		}
//		document.getElementById("output").innerHTML += typeof(poss[row][i]) + "<br>";
		var loc = poss[row][i].indexOf(val);
		if (loc != -1)
		{
			poss[row][i].splice(loc, 1);
		}
	}
	
	return poss;
} 
	
function resetPoss() 
{
	var poss = [];
	for (var i = 0;i < 4; i++) 
	{
		poss[i] = [];
		for (var j = 0; j < 4; j++) 
		{
			poss[i][j] = [];
			for (var k = 1; k <= 4; k++) 
			{
				poss[i][j].push(k);
			} 
		} 
	} 
	
	return poss;
} 

function copyArr(oldArr)
{
	var newArr = [];
	for (var i = 0; i < 4; i++)
	{
		newArr[i] = [];
		for (var j = 0; j < 4; j++)
		{
			newArr[i][j] = [];
			for (var k = 0; k < oldArr[i][j].length; k++)
			{
				newArr[i][j].push(oldArr[i][j][k]);
			}
		}
	}
	
	return newArr;
}

function newPuzz(cell, A, possRow, possClm, num)
{
	var i, j;
	var row = Math.floor(cell / num);
	var clm = cell % num;
	var cellVal;
	var possLoc;
	var found = false;
	var poss = [];

	for (var i = 1; i <= num; i++)
	{
		if (possRow[row].indexOf(i) != -1 && possClm[clm].indexOf(i) != -1)
		{
			poss.push(i);
		}
	}
	
	if (poss.length == 0)
	{
		var ans = [];
		ans[0] = false;
		ans[1] = A;
		ans[2] = possRow;
		ans[3] = possClm;
		return ans;
	}

	while (found == false)
	{
		if (poss.length == 0)
		{
			var ans = [];
			ans[0] = false;
			ans[1] = A;
			ans[2] = possRow;
			ans[3] = possClm;
			return ans;
		}
		
		possLoc = Math.floor(Math.random()*poss.length);
		cellVal = poss[possLoc];
		A[row][clm] = cellVal;
		
		var loc = possRow[row].indexOf(cellVal);
		possRow[row].splice(loc, 1);

		loc = possClm[clm].indexOf(cellVal);
		possClm[clm].splice(loc, 1);

		loc = poss.indexOf(cellVal);
		poss.splice(loc, 1);

		if (cell == num*num-1)
		{
			var ans = [];
			ans[0] = true;
			ans[1] = A;
			ans[2] = possRow;
			ans[3] = possClm;
			return ans;
		}
		else
		{
			found = newPuzz(cell+1, A, possRow, possClm, num)[0];
			if (!found)
			{
				possRow[row].push(cellVal);
				possClm[clm].push(cellVal);
			}
		}
	}

	var ans = [];
	ans[0] = true;
	ans[1] = A;
	ans[2] = possRow;
	ans[3] = possClm;
	return ans;
}

function init()
{
	var num = 4;
	var possClm = [];
	var possRow = [];
	var A = [];

	for(var i = 0; i < num; i++)
	{
		possClm[i] = [];
		possRow[i] = [];
		A[i] = [];

		for(var j = 0; j < num; j++)
		{
			possClm[i].push(j+1);
			possRow[i].push(j+1);
			A[i][j] = -1;
		}
  	}

	var ans = newPuzz(0, A, possRow, possClm, num);
	A = ans[1];

	return A;
}

function getclues(board, hv)
{
	var clues = [];
	if (hv[0] = 0)
	{
		clues.push([board[0][0], board[0][1]]);
		clues.push([board[1][0], board[1][1]]);
	}
	else if (hv[0] = 1)
	{
		clues.push([board[0][0], board[1][0]]);
		clues.push([board[0][1], board[1][1]]);
	}
	if (hv[1] = 0)
	{
		clues.push([board[0][2], board[0][3]]);
		clues.push([board[1][2], board[1][3]]);
	}
	else
	{
		clues.push([board[0][2], board[1][2]]);
		clues.push([board[0][3], board[1][3]]);
	}
	if (hv[2] = 0)
	{
		clues.push([board[2][0], board[2][1]]);
		clues.push([board[3][0], board[3][1]]);
	}
	else
	{
		clues.push([board[2][0], board[3][0]]);
		clues.push([board[2][1], board[3][1]]);
	}
	if (hv[3] = 0)
	{
		clues.push([board[2][2], board[2][3]]);
		clues.push([board[3][2], board[3][3]]);
	}
	else
	{
		clues.push([board[2][2], board[3][2]]);
		clues.push([board[2][3], board[3][3]]);
	}
	
	var clues2 = [];
	
	for (var i = 0; i < clues.length; i++)
	{
		clues2[i] = getHint(clues[i]);
	}
	
	return clues2;
}

function getHint(clue)
{
	var list = [];
	if (1 in clue && 2 in clue)
	{
		list.push("+3");
		list.push("-1");
		list.push("*2");
		list.push("/2");
		list.push("0%");
	}
	if (1 in clue && 3 in clue)
	{
		list.push("+4");
		list.push("-2");
		list.push("*3");
		list.push("/3");
		list.push("0%");
	}
	if (1 in clue && 4 in clue)
	{
		list.push("+5");
		list.push("-3");
		list.push("*4");
		list.push("/4");
		list.push("0%");
	}
	if (2 in clue && 3 in clue)
	{
		list.push("+5");
		list.push("-1");
		list.push("*6");
		list.push("1%");
	}
	if (2 in clue && 4 in clue)
	{
		list.push("+6");
		list.push("-2");
		list.push("*8");
		list.push("/2");
		list.push("0%");
	}
	if (3 in clue && 4 in clue)
	{
		list.push("+7");
		list.push("-1");
		list.push("*12");
		list.push("1%");
	}
	
	var ans = list[Math.floor(Math.random() * list.length())];
	
	return ans;
}

function feas(poss)
{
	for (var i = 0; i < 4; i++)
	{
		for (var j = 0; j < 4; j++)
		{
			if (poss[i][j].length == 0)
			{
				return false;
			}
		}
	}
	
	return true;
}

function dispBoard(board, hv)
{
	var out = "<table>";
	for (var i = 0; i < 7; i++)
	{
		out += "<tr>";
		for (var j = 0; j < 7; j++)
		{
			if (i % 2 == 0 && j % 2 == 0)
			{
				out += "<td>" + board[i / 2][j / 2] + "</td>";
			}
			else if (i == 3)
			{
				out += "<td>-</td>";
			}
			else if (j == 3)
			{
				out += "<td>|</td>";
			}
			
			if (hv[0] == 0 && i == 1 && (j == 0 || j == 1 || j == 2))
			{
				out += "<td>-</td>";
			}
			if (hv[0] == 0 && j == 1 && (i == 0 || i == 2))
			{
				out += "<td></td>";
			}
			
			if (hv[0] == 1 && j == 1 && (i == 0 || i == 1 || i == 2))
			{
				out += "<td>|</td>";
			}
			if (hv[0] == 1 && i == 1 && (j == 0 || j == 2))
			{
				out += "<td></td>";
			}
			
			if (hv[1] == 0 && i == 1 && (j == 4 || j == 5 || j == 6))
			{
				out += "<td>-</td>";
			}
			if (hv[1] == 0 && j == 5 && (i == 0 || i == 2))
			{
				out += "<td></td>";
			}
			
			if (hv[1] == 1 && j == 5 && (i == 0 || i == 1 || i == 2))
			{
				out += "<td>|</td>";
			}
			if (hv[1] == 1 && i == 1 && (j == 4 || j == 6))
			{
				out += "<td></td>";
			}
			
			if (hv[2] == 0 && i == 5 && (j == 0 || j == 1 || j == 2))
			{
				out += "<td>-</td>";
			}
			if (hv[2] == 0 && j == 1 && (i == 4 || i == 6))
			{
				out += "<td></td>";
			}
			
			if (hv[2] == 1 && j == 1 && (i == 4 || i == 5 || i == 6))
			{
				out += "<td>|</td>";
			}
			if (hv[2] == 1 && i == 5 && (j == 0 || j == 2))
			{
				out += "<td></td>";
			}
			
			if (hv[3] == 0 && i == 5 && (j == 4 || j == 5 || j == 6))
			{
				out += "<td>-</td>";
			}
			if (hv[3] == 0 && j == 5 && (i == 4 || i == 6))
			{
				out += "<td></td>";
			}
			
			if (hv[3] == 1 && j == 5 && (i == 4 || i == 5 || i == 6))
			{
				out += "<td>|</td>";
			}
			if (hv[3] == 1 && i == 5 && (j == 4 || j == 6))
			{
				out += "<td></td>";
			}
		}
		out += "</tr>";
	}
	out += "</table>";
	
	return out;
}

function detblcs(board)
{
	hv = [];
	for (var i = 0; i < 4; i++)
	{
		hv[i] = Math.floor(Math.random() * 2);
	}
	
	return hv;
}
</script>
</head>
<body>
<p id="output"></p>
<script type="text/javascript">
var board = init();
var hv = detblcs(board);
document.getElementById("output").innerHTML += dispBoard(board, hv);
</script>
</body>
</html>